/** wijmo-spread-master-v1.0.0 ISC License By  */
 ;!function(e,t){"use strict";let a=GrapeCity.UI,r=function(){};r.prototype.GetCopyContent=function(){try{let e="luckysheet-copy-content",a=t("#"+e);return a&&a.length>0||(a=t('<div id="'+e+'" style="display:none" ></div>'),t("body").append(a)),a}catch(e){}},r.prototype.GetCopyContentHtml=function(){try{return this.GetCopyContent().html()}catch(e){}},r.prototype.CopyContentSetOrClear=function(e){try{let t=this.GetCopyContent();return t.empty(),e&&t.html(e),t}catch(e){}};let o=function(e){this.setSpread(e)};o.prototype.setSpread=function(e){this.spreadDefult=new s(e)},o.prototype.getQKBorder=function(e,t,a){let r="",o=this.getBorderJson("paste");e.indexOf("pt")>-1?(e=parseFloat(e))<1||(r=e<1.5?"Medium":"Thick"):(e=parseFloat(e))<2||(r=e<3?"Medium":"Thick");let n=0;return"double"==(t=t.toLowerCase())?n=6:"dotted"==t?n="Medium"==r||"Thick"==r?o.mediumDashDot:o.dotted:"dashed"==t?n="Medium"==r||"Thick"==r?o.mediumDashed:o.dashed:"solid"==t&&(n="Medium"==r?o.medium:"Thick"==r?o.thick:o.thin),[n,a]},o.prototype.getBorderJson=function(e){let t="",a={0:"none",1:"thin",2:"medium",3:"dashed",4:"dotted",5:"thick",6:"double",7:"hair",8:"mediumDashed",9:"dashDot",10:"mediumDashDot",11:"dashDotDot",12:"mediumDashDotDot",13:"slantedDashDot"};if("paste"===e){t={};for(let e in a)e&&a[e]&&(t[a[e]]=parseFloat(e))}else t=a;return t},o.prototype.getHtmlBorderStyle=function(e,t){e||(e=0),t||(t="");let a="";return(e=this.getBorderJson("copy")[e.toString()]).indexOf("medium")>-1?a+="1pt ":a+="thick"==e?"1.5pt ":"0.5pt ","hair"==e?a+="double ":e.indexOf("dashDotDot")>-1?a+="dashDotDot ":e.indexOf("dashDot")>-1?a+="dashDot ":e.indexOf("dotted")>-1?a+="dotted ":e.indexOf("dashed")>-1?a+="dashed ":a+="solid ",a+t},o.prototype.vAlignDeal=function(e,t){try{let a={top:0,bottom:2,center:1,top:3,"text-top":3,"flex-start":0,"flex-end":2},r="";switch(t){case"copy":if(e)for(let t in a)if(a[t]==e){r=t;break}break;case"paste":r=void 0!==a[e]?a[e]:0}return{code:1,data:r,msg:""}}catch(e){return{code:1,data:"",msg:e}}},o.prototype.hAlignDeal=function(e,t){try{let a={left:0,right:2,center:1},r="";switch(t){case"copy":if(e)for(let t in a)if(a[t]==e){r=t;break}break;case"paste":r=void 0!==a[e]?a[e]:0}return{code:1,data:r,msg:""}}catch(e){return{code:1,data:"",msg:e}}},o.prototype.fontDeal=async function(e,t){try{let a,r=0,o="",n=0,s=!1,i="";switch(t){case"copy":r=0,e||(e=await this.spreadDefult._getDefaultFont()),o=e.split(/\s/g);break;case"paste":r=1;break;default:switch(typeof e){case"string":r=0,e||(e=await this.spreadDefult._getDefaultFont()),o=e.split(/\s/g);break;case"object":r=1}}let l={weight:{array:["bold"],default:"normal",label:"font-weight"},style:{array:["italic"],default:"normal",label:"font-style"},size:{regular:[/\d+px$/g,/\d+pt$/g,/\d+em$/g,/\d+rem$/g],label:"font-size"},family:{default:"宋体",array_index:"last",label:"font-family"},array_sort:["weight","style","size","family"],max_length:4};switch(r){case 0:i={};for(let e=0;e<o.length;e++){s=!1,a=o[e];for(let e=0;e<l.array_sort.length;e++){s=!1;let t=l.array_sort[e];if(!t||!l[t])continue;let r=l[t];if(!r.isFind){if(r.regular)for(let e=0;e<r.regular.length;e++)if(n=a.search(r.regular[e]),n>=0){s=!0;break}if(!s&&r.array&&r.array.indexOf(a)>=0&&(s=!0),s){i[t]=a,l[t].isFind=!0;break}if(!s&&r.array_index){switch(n=-1,r.array_index){case"first":n=0;break;case"last":n=o.length-1}n>0&&(n>l.max_length-1&&n-1>=0?i[t]=o[n-1]+" "+o[n]:i[t]=a)}}}}for(let e=0;e<l.array_sort.length;e++){let t=l.array_sort[e];if(!t||!l[t])continue;let a=l[t],r=t;a.label&&(r=a.label),!i[t]&&a.default?i[r]=a.default:i[t]&&(i[r]=i[t],delete i[t])}break;case 1:i="",1==e.font_weight?i+="bold":i+="normal",1==e.font_style?i+=" italic":i+=" normal",e.font_size&&(i=i+" "+e.font_size),e.font_family&&(i=i+" "+e.font_family)}return{code:1,data:i,msg:""}}catch(e){return{code:-1,data:void 0,msg:e}}};let n=function(e){this.setSpread(e),this.styleConvert=new o(e),this.contentMange=new r,this.pakoCompress=new l,this.jsHelper=new d};n.prototype.setSpread=function(e){this.spreadDefult=new s(e)},n.prototype.cellIsInSideSpan=function(e,t){let a=this.spans;for(let r=0;r<a.length;r++){let o=a[r];if(e>=o.row&&e<=o.row+o.rowCount-1&&t>=o.col&&t<=o.col+o.colCount-1)return e!=o.row||t!=o.col}return!1},n.prototype.getSpanByCell=function(e,t){let a=this.spans;for(let r=0;r<a.length;r++){let o=a[r];if(o.row==e&&o.col==t)return{code:1,data:o}}return{code:0,data:0}},n.prototype.SplicingHtml=function(e,t){let a="",r="",o="",n="";for(let t in e.tbody){let r="";for(let a in e.tbody[t]){let o="",n=e.tbody[t][a];for(let e in n.style)if(n.style[e])switch(typeof n.style[e]){case"string":o=o+""+e+":"+n.style[e]+";";break;case"object":for(let t in n.style[e])n.style[e][t]&&(o=o+""+t+":"+n.style[e][t]+";")}r+=`<td rowspan="${n.rowspan}" colspan="${n.colspan}" style="${o}" word-wraps="${n.wrod_wraps}">${n.value}</td>`}r&&(r=`<tr> ${r} </tr>`),a+=r}a=`<tbody> ${a} </tbody>`;for(let t in e.rowcolsize.col){let a=e.rowcolsize.col[t],o=`<column width="${a.width}" data-col-num="${a.index}" ishide ="${a.isVisible}"></column>`;n+=o,o=` <colgroup width="${a.width}"></colgroup>`,r+=o}o=`<table data-type="luckysheet_copy_action_table"> ${r}${a}</table>`;for(let t in e.rowcolsize.row){let a=e.rowcolsize.row[t];n+=`<row height="${a.height}" data-row-num="${a.index}" ishide ="${a.isVisible}"></row>`}n&&(n=`<rowcolsize>${n}</rowcolsize>`);let s="";return s=t&&t.isCopySheetInfo?'<sheet data-sheet-name ="'+e.sheet_name+'">'+n+'<table data-type="luckysheet_copy_action_table">'+o+"</table></sheet>":n+o,s},n.prototype.sheetEventCopy=async function(e,a,r){let o="";try{let n={isCopyHide:{row:!0,col:!0},isCopySheetInfo:!1};r||(r={}),r=t.extend({},n,r);let s={rowcolsize:{row:{},col:{}},tbody:{}},i="";i=await this.spreadDefult.getSheetById(a);let l,c=await this.spreadDefult.getSheetName(a);if(s.sheet_name=c,!i)return{code:-1,data:o,msg:"sheet获取失败"};e||(e=await this.spreadDefult.getSelections(a)).length>0&&(e=e[0]);let d={style:{border:{borderBottom:{label:"border-bottom"},borderLeft:{label:"border-left"},borderRight:{label:"border-right"},borderTop:{label:"border-top"}}}};this.spans=i.getSpans(e);for(let t=e.row;t<e.row+e.rowCount;t++){let a={},o=i.getRowVisible(t);if(o||r.isCopyHide.row){void 0===s.rowcolsize.row[t]&&(s.rowcolsize.row[t]={height:i.getRowHeight(t),isVisible:o,index:t-e.row});for(let o=e.col;o<e.col+e.colCount;o++)try{let n=i.getColumnVisible(o);if(!n&&!r.isCopyHide.col)continue;void 0===s.rowcolsize.col[o]&&(s.rowcolsize.col[o]={width:i.getColumnWidth(o),isVisible:n,index:o-e.col});let c={style:{},row:t,col:o};if(this.cellIsInSideSpan(t,o))continue;let h=this.getSpanByCell(t,o);if(h.code>0?(c.rowspan=h.data.rowCount,c.colspan=h.data.colCount):(c.rowspan=1,c.colspan=1),a["td"+o]=c,c.value=i.getValue(t,o),c.value||0==c.value||(c.value=""),null!=c.value&&void 0!==c.value||(c.value=""),l=i.getStyle(t,o),!l){c.wrod_wraps="auto-wraps";continue}l.wordWrap?c.wrod_wraps="auto-wraps":0==l.wordWrap&&(c.wrod_wraps="break"),c.style.font=(await this.styleConvert.fontDeal(l.font,"copy")).data,c.style["background-color"]=l.backColor,c.style.color=l.foreColor,c.style["text-align"]=this.styleConvert.hAlignDeal(l.hAlign,"copy").data,c.style["align-items"]=this.styleConvert.vAlignDeal(l.vAlign,"copy").data;for(let e in d.style.border)l[e]&&(c.style[d.style.border[e].label]=this.styleConvert.getHtmlBorderStyle(l[e].style,l[e].color))}catch(e){}s.tbody["tr"+t]=a}}return o=this.SplicingHtml(s,r),{code:1,data:o,msg:""}}catch(e){return{code:-1,data:o,msg:e}}},n.prototype.ManualCopy=async function(e,t,r,o,n){try{const s={isCopyHide:{row:!1,col:!1},isCopySheetInfo:!1,isShowSelect:!1,isDeleteUselessTag:!0,isMultipleSheet:!1,isfrozen:!0,index:void 0};n||(n={}),(n=Object.assign(s,n)).isShowSelect=o,e||(e=[0,0]),t||(t=[0,0]);let i,l,c="";if(n.isMultipleSheet){n.isCopySheetInfo=!0;let r=await this.spreadDefult.getSheetCount(),o=n.isMultipleSheet,s={},d=Object.keys(o),h=d.length;for(let p=0;p<h;p++){let h=d[p];s={},void 0!==h&&(h<0||h>r-1||(o[h].colRange?s.colRange=o[h].colRange:s.colRange=t,o[h].rowRange?s.rowRange=o[h].rowRange:s.rowRange=e,l=new a.Range(s.rowRange[0],s.colRange[0],s.rowRange[1]-s.rowRange[0]+1,s.colRange[1]-s.colRange[0]+1),i=await this.sheetEventCopy(l,h,n),n.isDeleteUselessTag&&(i.data=this.DeleteUselessTag(i.data)),c+=i.data))}}else l=new a.Range(e[0],t[0],e[1]-e[0]+1,t[1]-t[0]+1),i=await this.sheetEventCopy(l,n.index,n),n.isDeleteUselessTag&&(i.data=this.DeleteUselessTag(i.data)),c=i.data;if(r){return{code:1,data:this.pakoCompress.zip(c),message:""}}return{code:1,data:c,message:""}}catch(e){}},n.prototype.DeleteUselessTag=function(e){try{function a(e,t){return e-t}function r(e,t){try{if(t)return parseInt(t);let r=Array.from(e);r.length>0?(r.sort(a),t=r[r.length-1]+1):t=0}catch(e){}finally{e.has(t)||e.add(t)}}e&&this.contentMange.CopyContentSetOrClear(e);let o={},n={},s=0,i=0,l=new Set,c=new Set,d=0,h=0,p=this.contentMange.GetCopyContent();if(!p)return;p.find("column").each((function(){let e=t(this),a=e.attr("ishide");i=e.attr("data-col-num"),i=r(c,i),h=e.attr("width"),a='"true"'==a.toLowerCase(),d&&(row_height[s]=d),o[i]?o[i].isHide=a:o[i]={col_num:i,isHide:a}})),p.find("row").each((function(){let e=t(this),a=e.attr("ishide");s=e.attr("data-row-num"),s=r(l,s),d=e.attr("height"),a='"true"'==a.toLowerCase(),n[s]?n[s].isHide=a:n[s]={row_num:s,isHide:a}}));let u=Object.values(n).filter((e=>{if(e.isHide)return e})),f=p.find("tr"),y=f.length;for(let e=0;e<u.length;e++){let a=u[e];a.row_num>y-1&&a.row_num<0||t(f[a.row_num]).empty()}let w=["text-align","align-items","font-family","border-left","border-right","border-top","border-bottom"];return f.each((function(){let e=t(this).find("td"),a=e.length-1,r=[],o=!1;for(;a>=0&&!o;a--){let n=e[a],s=t(n);if(s.text())o=!0;else{for(let e=0;e<w.length;e++)if(n.style[w[e]]){o=!0;break}if(o)break;s.attr("word-wraps-excel")?o=!0:o||r.push(a)}}for(let a=0;a<r.length;a++)t(e[r[a]]).remove()})),this.contentMange.GetCopyContentHtml()}catch(e){}};let s=function(e){this.spread=e};s.prototype._getDefaultFont=async function(e){try{return(await this.getSheetById(e))._render._getDefaultFont()}catch(e){return""}},s.prototype.setColumnCount=async function(e,t){(await this.getSheetById(t)).setColumnCount(e)},s.prototype.getColumnCount=async function(e){(await this.getSheetById(e)).getColumnCount()},s.prototype.setRowCount=async function(e,t){(await this.getSheetById(t)).setRowCount(e)},s.prototype.getRowCount=async function(e){(await this.getSheetById(e)).getRowCount()},s.prototype.isPaintSuspended=async function(e){(await this.getDefaultSpred()).isPaintSuspended(e)},s.prototype.addSheet=async function(e,t){return(await this.getDefaultSpred()).addSheet(e,t),await this.getSheetCount()},s.prototype.addSpan=async function(e,t,a,r,o){try{let n=await this.getSheetById(o);return e=parseInt(e),t=parseInt(t),a=parseInt(a),r=parseInt(r),n.addSpan(e,t,a,r),{col:{min:t,max:t+r-1},row:{min:e,max:e+a-1}}}catch(e){}},s.prototype.setValue=async function(e,t,a,r){try{if(!a||""==a.trim())return void(a="");let o=await this.getSheetById(r);e=parseInt(e),t=parseInt(t),o.setValue(e,t,a)}catch(e){}},s.prototype.getStyle=async function(e,t,a){(await this.getSheetById(a)).getStyle(parseInt(e),parseInt(t))},s.prototype.setStyle=async function(e,t,r,o,n){try{let s=await this.getSheetById(o);if(e=parseInt(e),t=parseInt(t),n)return s.setStyle(parseInt(e),parseInt(t),r);let i=s.getStyle(parseInt(e),parseInt(t));i||(i=new a.Style);for(let e in i)r[e]&&(i[e]=r[e]);return s.setStyle(parseInt(e),parseInt(t),i)}catch(e){}},s.prototype.setRowVisible=async function(e,t,a){return(await this.getSheetById(a)).setRowVisible(parseInt(e),t)},s.prototype.setRowHeight=async function(e,t,a){return(await this.getSheetById(a)).setRowHeight(parseInt(e),t)},s.prototype.setColumnVisible=async function(e,t,a){return(await this.getSheetById(a)).setColumnVisible(parseInt(e),t)},s.prototype.setColumnWidth=async function(e,t,a){return(await this.getSheetById(a)).setColumnWidth(parseInt(e),t)},s.prototype.getSheetName=async function(e){return(await this.getSheetById(e)).getName()},s.prototype.setSheetName=async function(e,t){try{return(await this.getSheetById(e)).setName(t),await this.getSheetName(e)}catch(t){return await this.getSheetName(e)}},s.prototype.getSelections=async function(e){return(await this.getSheetById(e)).getSelections(e)},s.prototype.getDefaultSpred=async function(e){return e||(this.spread?this.spread:spread)},s.prototype.getActiveSheet=async function(e){return e||(e=await this.getDefaultSpred()),e.getActiveSheet()},s.prototype.getActiveSheetIndex=async function(e){return e||(e=await this.getDefaultSpred()),e.getActiveSheetIndex()},s.prototype.getSheetCount=async function(){return this.spread,this.spread.getSheetCount()},s.prototype.getSheetById=async function(e){let t="";if(void 0===e)t=await this.getActiveSheet();else{let a=this.getSheetCount();t=e<0?this.spread.getSheet(0):e>=a?this.spread.getSheet(a-1):this.spread.getSheet(e)}return t},s.prototype.clear=async function(e,t,a,r,o,n,s){(await this.getSheetById(s)).clear(e,t,a,r,o,n)},s.prototype.removeSpan=async function(e,t,a){(await this.getSheetById(a)).removeSpan(e,t)},s.prototype.get_dataModel=async function(e){return(await this.getSheetById(e))._dataModel},s.prototype.get_dataTable=async function(e){return(await this.get_dataModel(e)).dataTable};let i=function(e){this.setSpread(e)};i.prototype.setSpread=function(e){this.spreadDefult=new s(e)},i.prototype.getBorderRange=async function(e){let t={max:-Number.MAX_VALUE,min:Number.MAX_VALUE},a={max:-Number.MAX_VALUE,min:Number.MAX_VALUE};try{this.spreadDefult.getSheetById(e);let r,o,n,s=await this.spreadDefult.get_dataTable(e),i={borderBottom:{},borderLeft:{},borderRight:{},borderTop:{}};for(let e in s){o=s[e];for(let s in o)if(r=o[s],r&&(n=r.style,n))for(let r in i)n[r]&&n[r].style>0&&(s=parseInt(s),s>t.max&&(t.max=s),s<t.min&&(t.min=s),e=parseInt(e),e>a.max&&(a.max=e),e<a.min&&(a.min=e))}return{range_col:t,range_row:a}}catch(e){return{range_col:-1,range_row:-1}}},i.prototype.GetCellDataRangeBySheetid=async function(e){try{let t,a,r,o={max:-Number.MAX_VALUE,min:Number.MAX_VALUE},n={max:-Number.MAX_VALUE,min:Number.MAX_VALUE},s=await this.spreadDefult.get_dataTable(e);for(let e in s){a=s[e];for(let s in a)t=a[s],t&&(r=t.value,r&&(s=parseInt(s),s>o.max&&(o.max=s),s<o.min&&(o.min=s),e=parseInt(e),e>n.max&&(n.max=e),e<n.min&&(n.min=e)))}return{range_col:o,range_row:n}}catch(e){return{range_col:-1,range_row:-1}}},i.prototype.GetHasValueRange=async function(e,t,a){Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE;const r={border:{name:"border"},data:{name:"data"},all:{name:"all"}};try{let o;a||(a={}),a=Object.assign(a,r);let n=0;switch(t){case r.border.name:o=await this.getBorderRange(e);break;case r.data.name:o=await this.GetCellDataRangeBySheetid(e);break;case r.all.name:default:o=await this.getBorderRange(e),n=await this.GetCellDataRangeBySheetid(e),n.range_col.max>o.range_col.max&&(o.range_col.max=n.range_col.max),n.range_col.min<o.range_col.min&&(o.range_col.min=n.range_col.min),n.range_row.max>o.range_row.max&&(o.range_row.max=n.range_row.max),n.range_row.min<o.range_row.min&&(o.range_row.min=n.range_row.min)}return o}catch(e){return{range_col:-1,range_row:-1}}},i.prototype.GetHasValueRangeMultiple=async function(e,t,a){try{let t=0;if(!e){let t=this.spreadDefult.getSheetCount();e=[];for(let a=0;a<t;a++)e.push(a)}t=e.length;let a,r,o={};for(let n=0;n<t;n++)r=e[n],a=await this.GetHasValueRange(r),o[r]=a;return o}catch(e){}};let l=function(){};l.prototype.zip=function(e){let t=pako.gzip(encodeURIComponent(e),{level:7,to:"string"});return base64js.fromByteArray(t)},l.prototype.unzip=function(e){if(!e||"string"!=typeof e)return e;let t,a=base64js.toByteArray(e),r=pako.ungzip(a),o=8192;for(r=new Uint16Array(r),a="",t=0;t<r.length/o;t++)a+=String.fromCharCode.apply(null,r.slice(t*o,(t+1)*o));return a+=String.fromCharCode.apply(null,r.slice(t*o)),decodeURIComponent(a)},l.prototype.ungzip=function(e){if(!e||"string"!=typeof e)return e;let t,a=base64js.toByteArray(e),r=pako.ungzip(a),o=8192;for(r=new Uint16Array(r),a="",t=0;t<r.length/o;t++)a+=String.fromCharCode.apply(null,r.slice(t*o,(t+1)*o));return a+=String.fromCharCode.apply(null,r.slice(t*o)),decodeURIComponent(a)},l.prototype.Inflate=function(e){if(!e||"string"!=typeof e)return e;let t=base64js.toByteArray(e),a=new pako.Inflate;a.push(t,!0);let r,o=a.result,n=8192;for(o=new Uint16Array(o),t="",r=0;r<o.length/n;r++)t+=String.fromCharCode.apply(null,o.slice(r*n,(r+1)*n));return t+=String.fromCharCode.apply(null,o.slice(r*n)),decodeURIComponent(t)};let c=function(e){this.setSpread(e),this.styleConvert=new o,this.contentMange=new r,this.pakoCompress=new l,this.jsHelper=new d};c.prototype.setSpread=function(e){this.spreadDefult=new s(e)},c.prototype.ManualPaste=async function(e,a,r,o,n,s){try{let n={},i=this,l={sheet:{start_sheet_id:-1,satart_sheet_isAdd:!1,other_sheet_isAdd:!1,add_pos:"start",info:{},isSetColCount:!0,isSetRowCount:!0,needShowSheetId:"all"},isFrozen:!0};l.sheet.start_sheet_id=await i.spreadDefult.getActiveSheetIndex();let c,d,p="",u=[],f={},y=0,w=new Array,g=new Array;s||(s={}),s.sheet&&void 0!==s.sheet.start_sheet_id&&(s.sheet.add_pos="manual"),(s=this.jsHelper.deepCopyTo(l,s,{IsCover:!1})).isFrozen&&await this.spreadDefult.isPaintSuspended(!0),a||(a=0),r||(r=0),p=o?this.pakoCompress.unzip(e):e,this.contentMange.CopyContentSetOrClear(p);let m=this.contentMange.GetCopyContent();if(g=new Array,u=m.find("sheet"),!s.sheet.needShowSheetId||s.sheet.needShowSheetId.toLowerCase&&"all"==s.sheet.needShowSheetId.toLowerCase()){w=new Array;for(let e=0;e<u.length;e++)w.push(e);s.sheet.needShowSheetId=w}w=new Array;for(let e=0;e<s.sheet.needShowSheetId.length;e++)switch(c=s.sheet.needShowSheetId[e],d=this.jsHelper.judgeVariableType(c),d){case h.number.name:w.push(c);break;case h.string.name:w.push(parseInt(c))}s.sheet.needShowSheetId=w;for(let e=0;e<u.length;e++)s.sheet.needShowSheetId.indexOf(e)>=0&&g.push(u[e]);if(u=g,u&&u.length>0){let e=s.sheet.info,o=await this.spreadDefult.getSheetCount();switch(y=u.length,s.sheet.add_pos){case"start":s.sheet.start_sheet_id=0,s.sheet.satart_sheet_isAdd=!1;break;case"start_behind":s.sheet.start_sheet_id=0,s.sheet.satart_sheet_isAdd=!0;break;case"start_before":s.sheet.start_sheet_id=-1,s.sheet.satart_sheet_isAdd=!0;break;case"end":s.sheet.start_sheet_id=o-1,s.sheet.satart_sheet_isAdd=!0;break;case"manual":s.sheet.start_sheet_id>o?s.sheet.satart_sheet_isAdd?s.sheet.start_sheet_id=o-1:s.sheet.start_sheet_id=o:s.sheet.start_sheet_id<-1&&s.sheet.satart_sheet_isAdd?s.sheet.start_sheet_id=-1:s.sheet.start_sheet_id<0&&!s.sheet.satart_sheet_isAdd&&(s.sheet.start_sheet_id=0)}let l=s.sheet.start_sheet_id;async function c(o,c,d){let h=t(o),p={};e[c]&&(e[c].name&&(p.name=e[c].name),e[c].range&&(p.range=e[c].range)),p.name||(p.name=h.attr("data-sheet-name")),p.name&&i.spreadDefult.setSheetName(l+c,p.name),p.range||(p.range={col:r,row:a}),void 0===p.range.col&&(p.range.col=r),void 0===p.range.row&&(p.range.row=cow),n[d]=await i.luckysheetEventPaste(h.html(),p.range,d,s)}s.sheet.satart_sheet_isAdd?(s.sheet.start_sheet_id++,l++,o=await this.spreadDefult.addSheet(l)):l>o-1&&(o=await this.spreadDefult.addSheet(l)),l>o-1&&(l=o-1),await c(u[0],0,l);for(let e=1;e<y;e++){let t=l+e;s.sheet.other_sheet_isAdd?o=await i.spreadDefult.addSheet(t):t>o-1&&(o=await i.spreadDefult.addSheet(t),t=o-1),f=u[e],await c(f,e,t)}}else n=await i.luckysheetEventPaste(p,{row:a,col:r},s.sheet.start_sheet_id,s);return m.empty(),{code:1,data:n,message:"success",expect:void 0}}catch(e){return{code:-1,data:void 0,message:"fail",expect:e}}finally{s.isFrozen&&await this.spreadDefult.isPaintSuspended(!1)}},c.prototype.setWidthAndHeight=async function(e,t,a){try{let r=this;e||(e={}),t||(t={});for(let t in e)try{await r.spreadDefult.setRowHeight(t,e[t].height,a),await r.spreadDefult.setRowVisible(t,!e[t].ishide,a)}catch(e){}for(let e in t)try{await r.spreadDefult.setColumnWidth(e,t[e].width,a),await r.spreadDefult.setColumnVisible(e,!t[e].ishide,a)}catch(e){}}catch(e){}},c.prototype.getWidthAndHeight=async function(e,a){let r={},o={};try{function n(e,t){return e-t}a||(a={row:0,col:0}),a.row||(a.row=0),a.col||(a.col=0);let s=a.row,i=a.col;function l(e,t){try{if(t)return parseInt(t);let a=Array.from(e);a.length>0?(a.sort(n),t=a[a.length-1]+1):t=0}catch(e){}finally{e.has(t)||e.add(t)}}if(!e)return;"string"==typeof s&&(s=parseInt(s)),"string"==typeof i&&(i=parseInt(i));let c=0,d=0,h=new Set,p=new Set,u=0,f=0,y={},w={},g=this.contentMange.CopyContentSetOrClear(e);return g?(g.find("row").each((function(){try{let e=t(this);try{c=e.attr("data-row-num"),c=l(h,c)+s,u=e.attr("height"),u&&(y[c]=u);let t=e.attr("ishide");t=!(!t||'"true"'!=t.toLowerCase()),r[c]?(r[c].height=u,r[c].row=c,r[c].ishide=t):r[c]={height:u,row:c,ishide:t}}catch(e){}}catch(e){}})),g.find("column").each((function(){try{let e=t(this);d=e.attr("data-col-num"),d=l(p,d)+i,f=e.attr("width"),f&&(w[d]=f);let a=e.attr("ishide");a=!(!a||'"true"'!=a.toLowerCase()),o[d]?(o[d].height=u,o[d].col=d,o[d].ishide=a):o[d]={width:f,col:d,ishide:a}}catch(e){}})),{rowinfo:r,colinfo:o}):{rowinfo:r,colinfo:o}}catch(e){return{rowinfo:r,colinfo:o}}finally{this.contentMange.CopyContentSetOrClear()}},c.prototype.fomart=function(e){return e},c.prototype.setSpanBoder=async function(e,t,r){try{let o=parseInt(e.row),n=parseInt(e.col),s=parseInt(e.mc.rs),i=parseInt(e.mc.cs),l=this,c="";if(e.value,t.borderTop)for(let e=n;e<n+i;e++)c=await l.spreadDefult.getStyle(o,e),c||(c=new a.Style),c.borderTop=t.borderTop,await l.spreadDefult.setStyle(o,e,c,r,!1);if(t.borderBottom)for(let e=n;e<n+i;e++)c=await l.spreadDefult.getStyle(o+s-1,e),c||(c=new a.Style),c.borderBottom=t.borderBottom,await l.spreadDefult.setStyle(o+s-1,e,c,r,!1);if(t.borderLeft)for(let e=o;e<o+s;e++)c=await l.spreadDefult.getStyle(e,n),c||(c=new a.Style),c.borderLeft=t.borderLeft,await l.spreadDefult.setStyle(e,n,c,r,!1);if(t.borderRight)for(let e=o;e<o+s;e++)c=await l.spreadDefult.getStyle(e,n+i-1),c||(c=new a.Style),c.borderRight=t.borderRight,await l.spreadDefult.setStyle(e,n+i-1,c,r,!1)}catch(e){}},c.prototype.setDataAndBorder=async function(e,t){try{let r,o,n,s=e.length,i=this,l=-Number.MAX_VALUE,c=Number.MAX_VALUE,d=-Number.MAX_VALUE,h=Number.MAX_VALUE;for(let p=0;p<s;p++){r=e[p];for(let e=0;e<r.length;e++)try{if(o=r[e],!o||"undefined"==(o.row,!1)||void 0===o.col)continue;if(o.row>l&&(l=o.row),o.row<c&&(c=o.row),o.col>d&&(d=o.col),o.col<h&&(h=o.col),n=await i.spreadDefult.getStyle(o.row,o.col),n||(n=new a.Style),n.hAlign=o.horizontal,n.vAlign=o.vertical,n.backColor=o.backColor,n.foreColor=o.font_color,o.word_wraps,"2"===o.word_wraps)n.wordWrap=!0;else n.wordWrap=!1;if(o.border)for(let e in o.border)n[e]=o.border[e];if(n.font=(await i.styleConvert.fontDeal(o,"paste")).data,o.mc){let e=await i.spreadDefult.addSpan(o.mc.r,o.mc.c,o.mc.rs,o.mc.cs,t);e&&(e.row.max>l&&(l=e.row.max),e.row.min<c&&(c=e.row.min),e.col.max>d&&(d=e.col.max),e.col.min<h&&(h=e.col.min)),await i.setSpanBoder(o,n,t)}await i.spreadDefult.setStyle(o.row,o.col,n,t,!1),await i.spreadDefult.setValue(o.row,o.col,o.value,t)}catch(e){}}return{row:{max:l,min:c},col:{max:d,min:h}}}catch(e){}},c.prototype.getDataAndBorder=async function(e,a,r){let o=this;try{a||(a={row:0,col:0}),a.row||(a.row=0),a.col||(a.col=0);let r=this.contentMange.CopyContentSetOrClear(e),n=new Array(r.find("table tr").length),s=0;r.find("table tr").eq(0).find("td").each((function(){let e=parseInt(t(this).attr("colspan"));isNaN(e)&&(e=1),s+=e}));for(let e=0;e<n.length;e++)n[e]=new Array(s);let i=0,l={};return r.find("table tr").each((function(){let e=t(this),r=0;e.find("td").each((function(){let e=t(this),c={},d=e.text();if(0==t.trim(d).length)c.value=null;else{let t=o.fomart(e.text());c.value=t}let h=e.css("background-color");"rgba(0, 0, 0, 0)"==h&&(h=null),c.backColor=h;let p=e.css("font-weight");c.font_weight=400==p||"normal"==p?0:1;let u=e.css("font-style");c.font_style="normal"==u?0:1;let f=e.css("font-family").split(",");for(let e=0;e<f.length;e++){let a=t.trim(f[e].toLowerCase());if(null!=a){c.font_family=a;break}c.font_family=0}let y=e.css("font-size");c.font_size=y;let w=e.css("color");c.font_color=w;let g=e.css("text-align");c.horizontal=o.styleConvert.hAlignDeal(g,"paste").data;let m=e.css("align-items");c.vertical=o.styleConvert.vAlignDeal(m,"paste").data;let b=void 0===e.attr("word-wraps-excel")?e.attr("word-wraps"):e.attr("word-wraps-excel");for(c.word_wraps="auto-wraps"==b?"2":"overflow"==b?"1":"break"==b?"0":void 0;r<s&&null!=n[i][r];)r++;if(r==s)return!0;if(null==n[i][r]){n[i][r]=c;let t=parseInt(e.attr("rowspan")),s=parseInt(e.attr("colspan"));isNaN(t)&&(t=1),isNaN(s)&&(s=1);let d=a.row+i,h=a.col+r;c.row=d,c.col=h,c.border={};for(let a=0;a<t;a++)for(let p=0;p<s;p++){if(0==a){let t=e.css("border-top");if(null!=t&&t.length>0&&"0px"!=t.substr(0,3).toLowerCase()){let t=e.css("border-top-width"),r=e.css("border-top-style"),n=e.css("border-top-color"),s=o.styleConvert.getQKBorder(t,r,n);null==l[d+a+"_"+(h+p)]&&(l[d+a+"_"+(h+p)]={}),c.border.borderTop={style:s[0],color:s[1]},l[d+a+"_"+(h+p)].t={style:s[0],color:s[1]}}}if(a==t-1){let t=e.css("border-bottom");if(null!=t&&t.length>0&&"0px"!=t.substr(0,3).toLowerCase()){let t=e.css("border-bottom-width"),r=e.css("border-bottom-style"),n=e.css("border-bottom-color"),s=o.styleConvert.getQKBorder(t,r,n);null==l[d+a+"_"+(h+p)]&&(l[d+a+"_"+(h+p)]={}),c.border.borderBottom={style:s[0],color:s[1]},l[d+a+"_"+(h+p)].b={style:s[0],color:s[1]}}}if(0==p){let t=e.css("border-left");if(null!=t&&t.length>0&&"0px"!=t.substr(0,3).toLowerCase()){let t=e.css("border-left-width"),r=e.css("border-left-style"),n=e.css("border-left-color"),s=o.styleConvert.getQKBorder(t,r,n);null==l[d+a+"_"+(h+p)]&&(l[d+a+"_"+(h+p)]={}),c.border.borderLeft={style:s[0],color:s[1]},l[d+a+"_"+(h+p)].l={style:s[0],color:s[1]}}}if(p==s-1){let t=e.css("border-right");if(null!=t&&t.length>0&&"0px"!=t.substr(0,3).toLowerCase()){let t=e.css("border-right-width"),r=e.css("border-right-style"),n=e.css("border-right-color"),s=o.styleConvert.getQKBorder(t,r,n);null==l[d+a+"_"+(h+p)]&&(l[d+a+"_"+(h+p)]={}),c.border.borderRight={style:s[0],color:s[1]},l[d+a+"_"+(h+p)].r={style:s[0],color:s[1]}}}if(0!=a||0!=p)try{n[i+a][r+p]={mc:{r:d,c:h}}}catch(e){}}if(t>1||s>1){let e={rs:t,cs:s,r:d,c:h};n[i][r].mc=e}}return r++,r==s||void 0})),i++})),r.empty(),{data:n,borderInfo:l}}catch(e){return{}}},c.prototype.getPasteRange=function(e){try{let t,a,r=e.length,o=-Number.MAX_VALUE,n=Number.MAX_VALUE,s=-Number.MAX_VALUE,i=Number.MAX_VALUE;for(let l=0;l<r;l++){t=e[l];for(let e=0;e<t.length;e++)try{if(a=t[e],!a||"undefined"==(a.row,!1)||void 0===a.col)continue;let r=parseInt(a.row),l=parseInt(a.col);if(r>o&&(o=r),r<n&&(n=r),l>s&&(s=l),a.col<i&&(i=a.col),a.mc){let e=parseInt(a.mc.rs),t={col:{min:l,max:l+parseInt(a.mc.cs)-1},row:{min:r,max:r+e-1}};t&&(t.row.max>o&&(o=t.row.max),t.row.min<n&&(n=t.row.min),t.col.max>s&&(s=t.col.max),t.col.min<i&&(i=t.col.min))}}catch(e){}}return{row:{max:o,min:n},col:{max:s,min:i}}}catch(e){return{}}},c.prototype.clear=async function(e,t){try{let r=["Data","Style","Sparkline","Axis"];for(let o=0;o<r.length;o++)await this.spreadDefult.clear(e.row.min,e.col.min,e.row.max-e.row.min+1,e.col.max-e.col.min+1,a.SheetArea.viewport,a.StorageType[r[o]],t);for(let a=e.row.min;a<=e.row.max;a++)for(let r=e.col.min;r<=e.col.max;r++)await this.spreadDefult.removeSpan(a,r,t)}catch(e){}},c.prototype.setRowAndColCount=async function(e,t,a){try{let r=!1;if(e.col&&e.col.max){if(a&&a.sheet&&a.sheet.isSetColCount)r=!0;else{await this.spreadDefult.getColumnCount(t)<e.col.max+1&&(r=!0)}r&&(r=!1,await this.spreadDefult.setColumnCount(e.col.max+1,t))}if(e.row&&e.row.max){if(a&&a.sheet&&a.sheet.isSetRowCount)r=!0;else{await this.spreadDefult.getRowCount(t)<e.row.max+1&&(r=!0)}r&&(r=!1,await this.spreadDefult.setRowCount(e.row.max+1,t))}}catch(e){}},c.prototype.luckysheetEventPaste=async function(e,t,a,r){try{let o=await this.spreadDefult.getSheetCount();a||(a=0),a<0&&(a=0),a>o-1&&(o=await this.spreadDefult.addSheet(o),a=o-1);let n=await this.getDataAndBorder(e,t,r),s=await this.getWidthAndHeight(e,t),i={};return n&&n.data&&(i=await this.getPasteRange(n.data),await this.setRowAndColCount(i,a,r),await this.clear(i,a),i=await this.setDataAndBorder(n.data,a)),s&&await this.setWidthAndHeight(s.rowinfo,s.colinfo,a),i}catch(e){}};let d=function(){};d.prototype.deepCopyTo=function(e,t,a){a=Object.assign({IsCover:!1},a),t||"boolean"==typeof t||0==t||(t={});let r=this.judgeVariableType(e),o=this.judgeVariableType(t);switch(r){case h.string.name:case h.number.name:case h.boolean.name:case h.function.name:case h.array.name:void 0===t?a.IsCover&&(t=e):t=e;break;case h.json.name:o!=r&&(t={});for(let r in e){switch(this.judgeVariableType(t[r])){case h.string.name:case h.number.name:case h.boolean.name:case h.function.name:case h.array.name:if(!a.IsCover)continue}t[r]=this.deepCopyTo(e[r],t[r],a)}break;default:t=e}return t},d.prototype.judgeVariableType=function(e){try{let t=(typeof e).toLowerCase(),a="";switch(t){case h.string.name:case h.number.name:a=t;break;case h.object.name:e instanceof Array?a=h.array.name:e instanceof Object?a=e.constructor==Object?h.json.name:h.class.name:null==e&&(a=h.null.name);break;case h.function.name:case h.boolean.name:case h.undefined.name:a=t}return a}catch(e){return""}};const h={string:{name:"string"},number:{name:"number"},object:{name:"object"},array:{name:"array"},json:{name:"json"},class:{name:"class"},null:{name:"null"},function:{name:"function"},boolean:{name:"boolean"},undefined:{name:"undefined"}};e.pakoCompress=l,e.autoGetRange=i,e.contentMange=r,e.copyManual=n,e.jsHelper=d,e.pasteManual=c}(window,jQuery);